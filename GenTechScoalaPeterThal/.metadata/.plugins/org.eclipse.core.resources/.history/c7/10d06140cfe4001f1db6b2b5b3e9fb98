<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Carti</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"/>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet"
	href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css"/>
<link rel="stylesheet" type="text/css"
	href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css"/>
<script type="text/javascript" charset="utf8"
	src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" charset="utf8"
	src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>

<script>
	$(document).ready(
			function() {
				var table = $('#booksTable').DataTable({
					"paging": true,
			        "searching": true,
			        "ordering": true,
					"serverSide" : true,
					"ajax" : {
						"url" : "/books2", // Endpoint-ul pentru obținerea cărților
						"type" : "GET",
						"data" : function(d) {
							
							d.title = $('#titleSearch').val();
							d.author = $('#authorSearch').val();
							d.publicationYear = $('#yearSearch').val();
							d.genre = $('#genreSearch').val();
						},
						"dataSrc" : function(json) {
							// Check the response structure in the console
							console.log(json);
							return json.data;
						}
					},
					"columns" : [ {
						"data" : "title"
					}, {
						"data" : "author"
					}, {
						"data" : "genre.name"
					}, {
						"data" : "publicationYear"
					} ]
				});
				
				// Căutarea pe fiecare coloană
				$('#titleSearch, #authorSearch, #genreSearch, #yearSearch').on(
						'input change', function() {
							disableSorting = true;

					        // Remove the click event listener from the headers to prevent sorting
					        $('#example thead th').off('click');
						        
						});

				var disableSorting=false;
				$('#searchForm').on('submit', function(e) {
					e.preventDefault(); 
					table.ajax.reload(); 
				});
				
				$('#titleSearch, #authorSearch, #genreSearch, #yearSearch').on('focus', function(e) {
					//table.off('order.dt');
					disableSorting=true;
			    });

			   
			    $('#titleSearch, #authorSearch, #genreSearch, #yearSearch').on('blur', function() {
			    	disableSorting=false;
			    });
			    
			    $('#booksTable').on('order.dt', function() {
			    	console.log(disableSorting);
			        if (disableSorting) {
			            // Prevent sorting action if the flag is true
			            return false;
			        }
			    });
				$("#booksTable_length").hide();
				$("#booksTable_filter").hide();
			});
	
</script>
</head>
<body>
	<form id="searchForm" method="get">
		<!-- Tabelul pentru DataTable -->
		<table id="booksTable" class="display">
			<thead>
			
				 <tr>
            <th>Titlu <br/> <input type="text" id="titleSearch" placeholder="Cauta dupa titlu"></th>
            <th>Autor <br/> <input type="text" id="authorSearch" placeholder="Cauta dupa autor"></th>
            <th>Gen<br/>  <input type="text" id="genreSearch" placeholder="Cauta dupa gen"></th>
            <th>Anul publicarii<br/>  <input type="number" id="yearSearch" placeholder="Cauta dupa an"></th>
        </tr>
			
			</thead>
			<tbody>
				<!-- Cărțile vor fi populate aici prin AJAX -->
			</tbody>
		</table>
	</form>


</body>
</html>