<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Carti</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	// Funcția de căutare AJAX
	function searchBooks() {
		var title = $('#title').val();
		var author = $('#author').val();
		var genre = $('#genre').val();
		var publicationYear = $('#publicationYear').val();
		var sortBy = $("#sortBy").val();
		var direction = $("#direction").val()
		$.ajax({
			url : '/searchBooks',
			data : {
				title : title,
				author : author,
				genre : genre,
				publicationYear : publicationYear,
				sortBy : sortBy,
				direction : direction
			},
			success : function(response) {
				var tableBody = $('#booksTable tbody');
				tableBody.empty(); // Ștergem datele existente

				response.forEach(function(book) {
					var row = $('<tr>');
					row.append('<td>' + book.title + '</td>');
					row.append('<td>' + book.author + '</td>');
					row.append('<td>' + book.genre.name + '</td>');
					row.append('<td>' + book.publicationYear + '</td>');
					tableBody.append(row);
				});
			}
		});
	}

	$(document).ready(function() {
		searchBooks();
		$('#title, #author, #genre, #publicationYear').on('input', function() {
			searchBooks();
		});
		$('.sortButton').on('click', function() {
			var sortBy = $(this).data('sortby');
	        var currentDirection = $('#direction').val();
	        var newDirection = currentDirection === 'asc' ? 'desc' : 'asc';

	        // Setăm valorile în inputurile ascunse
	        $('#sortBy').val(sortBy);
	        $('#direction').val(newDirection);

	        searchBooks(); // Reîmprospătăm lista cu noile setări de sortare

	        // Schimbăm direcția și iconița săgeții
	        $('.sortButton').removeClass('sorted-asc sorted-desc');
	        if (newDirection === 'asc') {
	            $(this).addClass('sorted-asc');
	        } else {
	            $(this).addClass('sorted-desc');
	        }
		});

		
	});
</script>
<link rel="stylesheet" type="text/css" href="/css/style.css">
</head>
<body>
	<form id="searchForm" method="get" action="/books">

		<table id="booksTable">
			<thead>
				<tr>
					<th><input type="text" id="title" name="title"
						placeholder="Search by Title" /></th>
					<th><input type="text" id="author" name="author"
						placeholder="Search by Author" /></th>
					<th>
						<!-- Dropdown pentru genuri --> <select id="genre" name="genre">
							<option value="">Select Genre</option>
							<option th:each="g : ${genres}" th:value="${g.id}"
								th:text="${g.name}"></option>
					</select>
					<button type="button" data-sortby="genre" class="sortButton btn btn-light">
    
    <span id="genre-sort-indicator" class="ml-2">
        <i class="fa fa-sort"></i> <!-- icoană pentru săgeată -->
    </span>
</button>
					</th>
					<th><input type="number" id="publicationYear"
						name="publicationYear" placeholder="Search by Year" /></th>
				</tr>
				<tr>
					<!-- Buton pentru sortare după Title -->
					<th>
						<button type="button" data-sortby="title" class="sortButton">
							Title <span id="title-sort-indicator"></span>
						</button>
					</th>
					<!-- Buton pentru sortare după Author -->
					<th>
						<button type="button" data-sortby="author" class="sortButton">
							Author <span id="author-sort-indicator"></span>
						</button>
					</th>
					<!-- Buton pentru sortare după Genre -->
					<th>
						<button type="button" data-sortby="genre"
							class="sortButton btn btn-light">
							Genre <span id="genre-sort-indicator" class="ml-2"> <i
								class="fa fa-sort"></i> <!-- icoană pentru săgeată -->
							</span>
						</button>
					</th>
					<!-- Buton pentru sortare după Publication Year -->
					<th>
						<button type="button" data-sortby="publicationYear"
							class="sortButton">
							Publication Year <span id="publicationYear-sort-indicator"></span>
						</button>
					</th>
				</tr>
			</thead>
			<tbody>
				<!-- Cărțile vor fi populate aici prin AJAX -->
			</tbody>
		</table>
		<input type="hidden" id="sortBy" name="sortBy" /> <input
			type="hidden" id="direction" name="direction" />
	</form>

</body>
</html>